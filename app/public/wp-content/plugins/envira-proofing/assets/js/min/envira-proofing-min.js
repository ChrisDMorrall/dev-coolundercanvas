jQuery(document).ready(function($){function e(e){$(".envirabox-proofing form.envira-proofing-form-lightbox input").each(function(){var i=$(this).attr("name"),o=i.split("][");switch($(this).attr("type")){case"checkbox":if(1==o.length)var n=$('input[name="envira_proofing[images]['+e+']"]').prop("checked");if(2==o.length)var a=o[1].replace("]",""),n=$('input[name="envira_proofing[quantities]['+e+"]["+a+']"]').prop("checked");$(this).prop("checked",n);break;default:if(1==o.length)var r=$('input[name="envira_proofing[quantities]['+e+']"]').val();if(2==o.length)var a=o[1].replace("]",""),r=$('input[name="envira_proofing[quantities]['+e+"]["+a+']"]').val();$(this).val(r);break}})}function i(e){jQuery(document).ready(function($){$(".envirabox-proofing form.envira-proofing-form-lightbox input").each(function(){var i=$(this).attr("name"),o=i.split("][");switch($(this).attr("type")){case"checkbox":var n=$(this).prop("checked");if(1==o.length&&$('input[name="envira_proofing[images]['+e+']"]').prop("checked",n).trigger("change"),2==o.length){var a=o[1].replace("]","");$('input[name="envira_proofing[quantities]['+e+"]["+a+']"]').prop("checked",n)}break;default:if(1==o.length){var r=$(this).val();$('input[name="envira_proofing[quantities]['+e+']"]').val(r)}if(2==o.length){var a=o[1].replace("]",""),r=$(this).val();$('input[name="envira_proofing[quantities]['+e+"]["+a+']"]').val(r)}break}})})}var o=[],n=[];if(object=!1,current=!1,instance=!1,void 0!==Cookies.get("envira_proof_image_ids")&&""!=Cookies.get("envira_proof_image_ids")){var a=Cookies.get("envira_proof_image_ids");o=$.parseJSON(a),console.log("starting with ids:"),console.log(o)}if(void 0!==Cookies.get("envira_proof_images")&&""!=Cookies.get("envira_proof_images")){var r=Cookies.get("envira_proof_images");n=$.parseJSON(r),console.log("starting with images:"),console.log(n)}var t=function(e){if($(e).prop("checked")){$(".envira-proofing-fields",$(e).parent()).fadeIn(),$(e).closest(".envira-gallery-item-inner").addClass("envira-proofing-selected");var i=$("img",$(e).closest(".envira-gallery-item-inner")).attr("src"),t=$("img",$(e).closest(".envira-gallery-item-inner")).data("envira-item-id");0==$("div.envira-proofing-summary-box-inner div.images-inner div.image img[src='"+i+"'] ").length&&$("div.envira-proofing-summary-box-inner div.images-inner").append('<div class="image" data-src="'+i+'"><img src="'+i+'" /></div>');var s=JSON.stringify(t),g=JSON.stringify(i);-1===$.inArray(s,o)&&o.push(s),a=JSON.stringify(o),void 0===Cookies.get("envira_proof_image_ids")||""==Cookies.get("envira_proof_image_ids")?(Cookies.remove("envira_proof_image_ids",{path:"/"}),Cookies.set("envira_proof_image_ids",a,{expires:2,path:"/"})):Cookies.set("envira_proof_image_ids",a,{expires:2,path:"/"}),-1===$.inArray(g,n)&&n.push(g),r=JSON.stringify(n),void 0===Cookies.get("envira_proof_images")||""==Cookies.get("envira_proof_images")?(Cookies.remove("envira_proof_images",{path:"/"}),Cookies.set("envira_proof_images",r,{expires:2,path:"/"})):Cookies.set("envira_proof_images",r,{expires:2,path:"/"}),"0"!=$("div.envira-proofing-summary-box-inner").css("bottom")&&$("div.envira-proofing-summary-box-inner").animate({bottom:"0"})}else{var i=$("img",$(e).closest(".envira-gallery-item-inner")).attr("src"),t=$("img",$(e).closest(".envira-gallery-item-inner")).data("envira-item-id"),s=JSON.stringify(t),g=JSON.stringify(i);o.splice($.inArray(s,o),1),a=JSON.stringify(o),n.splice($.inArray(g,n),1),r=JSON.stringify(n),Cookies.remove("envira_proof_image_ids",{path:"/"}),Cookies.set("envira_proof_image_ids",a,{expires:2,path:"/"}),Cookies.remove("envira_proof_images",{path:"/"}),Cookies.set("envira_proof_images",r,{expires:2,path:"/"}),$(".envira-proofing-fields",$(e).parent()).fadeOut().promise().done(function(){$(p).hasClass("enviratope")&&p.enviraImagesLoaded().done(function(){p.enviratope("layout")}).progress(function(){p.enviratope("layout")})}),$(e).closest(".envira-gallery-item-inner").removeClass("envira-proofing-selected");var p=$(e).closest(".envira-gallery-public"),i=$("img",$(e).closest(".envira-gallery-item-inner")).attr("src");$('div.envira-proofing-summary-box-inner div.images-inner div[data-src="'+i+'"]').remove()}0==$("div.envira-proofing-summary-box-inner div.images div.image").length&&$("div.envira-proofing-summary-box-inner").animate({bottom:"-80px"})};$(document).on("change",".envira-gallery-wrap .envira-proofing-fields input[type=number]",function(){var e=$(this).attr("name"),i=e.match(/\[(.*)\]{1}\[(.*)\]{1}\[(.*)\]{1}/),o=i[2],n=i[3],a=$(this).val(),r=!1,t=Array(0);void 0!==Cookies.get("envira_proof_image_fields")&&""!=Cookies.get("envira_proof_image_ids")&&(r=Cookies.get("envira_proof_image_fields"),t=$.parseJSON(r));var s={},g={};g.size=n,g.quantity=a,s[o]=g,t.push(s),Cookies.remove("envira_proof_image_fields",{path:"/"}),Cookies.set("envira_proof_image_fields",t,{expires:2,path:"/"})}),$(document).on("envirabox_api_before_show",function(e,i,o,n){object=!1,instance=!1,current=!1}),$(document).on("envirabox_api_after_show",function(e,i,o,n){object=i,instance=o,current=n}),$(document).on("change",".envirabox-inner .envira-proofing-fields input[type=number]",function(){var e=current.enviraItemId,i=$(this).attr("name"),o=i.match(/\[(.*)\]{1}\[(.*)\]{1}/),n=e,a=o[2],r=$(this).val(),t=!1,s=Array(0);console.log("ON CHANGE actual_enviraItemId"),console.log(e),console.log("image_id"),console.log(n),void 0!==Cookies.get("envira_proof_image_fields")&&""!=Cookies.get("envira_proof_image_ids")&&(t=Cookies.get("envira_proof_image_fields"),s=$.parseJSON(t));var g={},p={};if(p.size=a,p.quantity=r,g[n]=p,!1!==s){var l=!1;$.each(s,function(e,i){$.each(i,function(e,i){e==n&&i.size==a&&(l=!0,i.quantity=r)})}),!1===l&&s.push(g)}console.log("image_fields"),console.log(s),Cookies.remove("envira_proof_image_fields",{path:"/"}),Cookies.set("envira_proof_image_fields",s,{expires:2,path:"/"})});var a=Cookies.get("envira_proof_image_ids");if(void 0!==a){var s=$.parseJSON(a);"0"!=$("div.envira-proofing-summary-box-inner").css("bottom")&&$("div.envira-proofing-summary-box-inner").animate({bottom:"0"}),$.each(s,function(e,i){var o=$(document).find('[data-envira-item-id="'+i+'"]'),n=o.attr("src"),a=o.closest(".envira-gallery-item-inner").find("input.envira-proofing-select-image"),r=a.parent().find(".envira-proofing-fields");0==$("div.envira-proofing-summary-box-inner div.images-inner div.image img[src='"+n+"'] ").length&&(a.attr("checked","checked"),void 0!==r&&(console.log(r),r.css("display","block")))})}else $("input.envira-proofing-select-image").prop("checked",!1);var g=Cookies.get("envira_proof_images");if(void 0!==g){var p=$.parseJSON(g);$.each(p,function(e,i){i=i.replace(/\"/g,""),0==$("div.envira-proofing-summary-box-inner div.images-inner div.image img[src='"+i+"'] ").length&&$("div.envira-proofing-summary-box-inner div.images-inner").append('<div class="image" data-src="'+i+'"><img src="'+i+'" /></div>')})}$(document).on("change","input.envira-proofing-select-image",function(){var e=t($(this)),i=$(this).closest(".envira-gallery-public"),o=$(i).attr("id").split("-"),n=o[2];$(i).hasClass("enviratope")&&$(i).enviratope("layout")}),$(document).on("change","input.envira-proofing-lightbox-select-image",function(){var e=$(this).closest(".envirabox-image"),i=$(e).data("envira-gallery-id"),o=$("#envira-gallery-"+i);$(this).prop("checked")?$(".envira-proofing-fields",$(this).parent().parent()).fadeIn():($(".envira-proofing-fields",$(this).parent().parent()).fadeOut(),$(o).hasClass("enviratope")&&$(o).enviratope("layout"))}),$("div.envira-proofing-summary-box-inner div.images-inner").mousewheel(function(e,i){this.scrollLeft-=10*i,e.preventDefault()}),$("div.envira-proofing-summary-box-inner div.buttons button").on("click",function(e){e.preventDefault();var i=$(this).closest("div.envira-proofing-summary-box").data("envira-id"),o=$('form[data-envira-id="'+i+'"]');o.find("input#envira_proofing_selected_images").val(Cookies.get("envira_proof_images")),o.find("input#envira_proofing_selected_images_ids").val(Cookies.get("envira_proof_image_ids")),o.find("input#envira_proofing_selected_images_fields").val(Cookies.get("envira_proof_image_fields")),$("input[name="+$(this).attr("name")+"]",$(o)).trigger("click")}),$(document).on("envirabox_api_after_show",function(o,n,a,r){if(console.log("obj"),console.log(n),console.log("current"),console.log(r),!1!==n.get_config("proofing")&&!1!==n.get_config("proofing_lightbox")){console.log("made it"),$(".envirabox-container").addClass("envirabox-proofing");var t=n.data.proofing_quantity_enabled,s=n.data.proofing_size_enabled,g=n.data.proofing_sizes,p=!1;if(item_id=r.enviraItemId,proofing_add_to_order_label=n.data.proofing_submit_button_label?n.data.proofing_submit_button_label:"Add To Order",console.log("quantity_enabled"),console.log(t),console.log("sizes_enabled"),console.log(s),console.log("sizes"),console.log(g),console.log("sizes length"),console.log(Object.keys(g).length),p='<form action="#" method="post" class="envira-proofing-form envira-proofing-form-lightbox"><div class="envira-proofing-field"><label for="envira_proofing_lightbox_quantity">'+proofing_add_to_order_label+'</label><input type="checkbox" name="envira_proofing_lightbox[images]" value="1" class="envira-proofing-lightbox-select-image envira-proofing-checkbox" /></div><div class="envira-proofing-fields">',1===t&&1===s&&Object.keys(g).length>0){console.log("choice 1");for(prop in g)console.log(g[prop]),p+='<div class="envira-proofing-field"><label for="envira_proofing_lightbox_quantity_'+g[prop].slug+'">'+g[prop].name+'</label><input type="number" name="envira_proofing_lightbox[quantities]['+g[prop].name+']" id="envira_proofing_lightbox_quantity_'+g[prop].slug+'" min="0" class="envira-proofing-number" /></div>'}else if(t&&!s)console.log("choice 2"),p+='<div class="envira-proofing-field"><label for="envira_proofing_lightbox_quantity">Quantity</label><input type="number" name="envira_proofing_lightbox[quantities]" id="envira_proofing_lightbox_quantity" min="0" value="0" class="envira-proofing-number" /></div>';else if(0===t&&1===s&&Object.keys(g).length>0){console.log("choice 3");for(prop in g)console.log(g[prop]),p+='<div class="envira-proofing-field"><label for="envira_proofing_lightbox_quantity_'+g[prop].slug+'">'+g[prop].name+'</label><input type="checkbox" name="envira_proofing_lightbox[quantities]['+g[prop].name+']" id="envira_proofing_lightbox_quantity_'+g[prop].slug+'" value="1" class="envira-proofing-checkbox" /></div>'}else console.log("choice 4");p+="</div></form>",$(".envirabox-stage .envira-proofing input").off("change.envira_proofing_lightbox"),$(".envirabox-stage .envira-proofing").remove(),$(".envirabox-stage .envirabox-slide--current .envirabox-image-wrap").append('<div class="envira-proofing"></div>'),$(".envirabox-stage .envira-proofing").append(p),e(item_id),$(".envirabox-stage .envira-proofing input").on("change.envira_proofing_lightbox",function(){i(item_id)})}})});